<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>cockpit.js</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="index.html" title="Cockpit Guide">
<link rel="up" href="api-base1.html" title="API: latest">
<link rel="prev" href="api-base1-cockpit-css.html" title="cockpit.css">
<link rel="next" href="api-base1-jquery.html" title="jquery.js">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="2"><tr valign="middle">
<td><a accesskey="p" href="api-base1-cockpit-css.html"><img src="left.png" width="24" height="24" border="0" alt="Prev"></a></td>
<td><a accesskey="u" href="api-base1.html"><img src="up.png" width="24" height="24" border="0" alt="Up"></a></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="24" height="24" border="0" alt="Home"></a></td>
<th width="100%" align="center">Cockpit Guide</th>
<td><a accesskey="n" href="api-base1-jquery.html"><img src="right.png" width="24" height="24" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry">
<a name="api-cockpit"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle">cockpit.js</span></h2>
<p>cockpit.js â€” Basic cockpit API to interact with the system</p>
</td>
<td valign="top" align="right"></td>
</tr></table></div>
<div class="refsection">
<a name="idm139751633893872"></a><h2>Loading cockpit.js</h2>
<p><code class="code">cockpit.js</code> should be loaded via a script tag. In general jQuery should
      be loaded before <code class="code">cockpit.js</code> as in the example below. If jQuery is not loaded
      then only the <a class="link" href="api-cockpit.html#cockpit-channels" title="Raw Channels">raw channel API</a> will be defined.</p>
<pre class="programlisting">
  &lt;script src="../base1/jquery.js"&gt;
  &lt;script src="../base1/cockpit.js"&gt;
</pre>
</div>
<div class="refsection">
<a name="idm139751633896704"></a><h2>User Login</h2>
<div class="refsection">
<a name="cockpit-logout"></a><h3>cockpit.logout()</h3>
<pre class="programlisting">
  cockpit.logout([reload])
</pre>
<p>Logout of Cockpit. Unless <code class="code">reload</code> is <code class="code">false</code> this will also
        cause the page to be reloaded, so that the user can see the logged out state.</p>
</div>
<div class="refsection">
<a name="cockpit-user"></a><h3>cockpit.user</h3>
<pre class="programlisting">
  cockpit.user["user"]
  cockpit.user["name"]
  cockpit.user["groups"]
  cockpit.user["shell"]
  cockpit.user["home"]
  cockpit.user["id"]
</pre>
<p>This object contains information about the user that's currently logged into cockpit.
        The following fields are defined:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">"groups"</code></span></p></td>
<td><p>This is an array of group names to which the user belongs.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"home"</code></span></p></td>
<td><p>This is user's home directory.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"id"</code></span></p></td>
<td><p>This is unix user id.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"name"</code></span></p></td>
<td><p>This is a readable name for the user.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"shell"</code></span></p></td>
<td><p>This is unix user shell.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"user"</code></span></p></td>
<td><p>This is the unix user like <code class="code">"root"</code>.</p></td>
</tr>
</tbody>
</table></div>
<p>The fields will be <code class="code">undefined</code> until a connection is made to the
        cockpit server.</p>
</div>
<div class="refsection">
<a name="cockpit-info-changed"></a><h3>cockpit.user.onchanged</h3>
<pre class="programlisting">
  $(cockpit.user).on("changed", function() { ... })
</pre>
<p>This event is fired when the user info changes or first becomes available.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-location"></a><h2>Page Location</h2>
<pre class="programlisting">
  location = cockpit.location
  cockpit.location = "/path"
</pre>
<p>Cockpit components often have different views, without changing the HTML file that is
      being viewed. These are known as pages. <code class="code">cockpit.location</code> is an object that can
      be used to read the current page and to navigate to a different page location. It works by
      updating <code class="code">window.location.hash</code>.</p>
<p>The <code class="code">cockpit.location</code> looks like a HTTP path with a possible query
      string:</p>
<pre class="programlisting">
 /path/sub/page?option=value,option2
</pre>
<p>The <a class="link" href="api-cockpit.html#cockpit-location-path" title="location.path"><code class="code">location.path</code></a> and
      <a class="link" href="api-cockpit.html#cockpit-location-options" title="location.options"><code class="code">location.options</code></a> contain a parsed
      form of the location. While the location cannot be modified in place, a new one can be
      created by assigning a string to <code class="code">cockpit.location</code> or by calling the
      <a class="link" href="api-cockpit.html#cockpit-location-go" title="location.go()"><code class="code">location.go()</code></a> function.</p>
<p><code class="code">cockpit.location</code> is designed similarly to <code class="code">window.location</code>
      in that the location object is preplaced whenever the current page location changes. To be
      aware of when the page location changes listen for the
      <a class="link" href="api-cockpit.html#cockpit-location-changed" title="cockpit.onlocationchanged"><code class="code">cockpit.onlocationchanged</code></a>
      event.</p>
<p>Using the location object as a string will result in the
      <a class="link" href="api-cockpit.html#cockpit-location-href" title="location.href"><code class="code">location.href</code></a>.</p>
<div class="refsection">
<a name="cockpit-location-href"></a><h3>location.href</h3>
<p>The string representation of this page location, including any options.</p>
</div>
<div class="refsection">
<a name="cockpit-location-path"></a><h3>location.path</h3>
<p>An array of path segments, parsed and decoded appropriately. An empty array denotes
        the root path.</p>
</div>
<div class="refsection">
<a name="cockpit-location-options"></a><h3>location.options</h3>
<p>A javascript object containing the various options present in the location.</p>
</div>
<div class="refsection">
<a name="cockpit-location-go"></a><h3>location.go()</h3>
<pre class="programlisting">
  location.go(path, [options])
</pre>
<p>Changes the current location to the given <code class="code">path</code> and <code class="code">options</code>.
        If the <code class="code">path</code> argument is a string, it will be parsed into a path. If it is
        a relative path, then the result will be relative to the current <code class="code">location.path</code>.
        If the <code class="code">path</code> argument is an array of path segments, it will be treated as a
        full parsed absolute path.</p>
<p>Any options found in a <code class="code">path</code> will be added to those in the optional
        <code class="code">options</code> argument, and used in the result.</p>
<p>The location change will only take effect if the location has not changed in the
        meantime. This can be to good effect by saving a <code class="code">cockpit.location</code> object
        and doing a conditional navigation, by calling the saved <code class="code">location.go()</code>
        method later. This will only navigate if the user or other code has not navigated in
        the meantime.</p>
</div>
<div class="refsection">
<a name="cockpit-location-replace"></a><h3>location.replace()</h3>
<pre class="programlisting">
  location.replace(path, [options])
</pre>
<p>Similar to <a class="link" href="api-cockpit.html#cockpit-location-go" title="location.go()"><code class="code">location.go()</code></a>
        except the location change will not result in a navigation change in the browser's
        history.</p>
</div>
<div class="refsection">
<a name="cockpit-location-decode"></a><h3>location.decode()</h3>
<pre class="programlisting">
  path = location.decode(href, [options])
</pre>
<p>Decode a cockpit href into its <code class="code">path</code> array. If the <code class="code">options</code>
        argument is specified, then it will be populated with options found in the href.</p>
<p>If href is a relative path it will be resolved relative to
        <code class="code">location.href</code>.</p>
</div>
<div class="refsection">
<a name="cockpit-location-encode"></a><h3>location.encode()</h3>
<pre class="programlisting">
  href = location.encode(path, [options])
</pre>
<p>Encode the given <code class="code">path</code> and <code class="code">options</code> into a cockpit href.
        The <code class="code">path</code> argument may be an array of path segments, or a string path. If
        a relative path is passed, it will be resolved relative to <code class="code">location.href</code>.</p>
</div>
<div class="refsection">
<a name="cockpit-location-changed"></a><h3>cockpit.onlocationchanged</h3>
<pre class="programlisting">
 $(cockpit).on("locationchanged", function() { ... })
</pre>
<p>An event emitted when over the <code class="code">cockpit.location</code> changes. Typically a
        component reacts to this event by updating its interface to reflect the new
        <a class="link" href="api-cockpit.html#cockpit-location-path" title="location.path"><code class="code">cockpit.location.path</code></a> and
        <a class="link" href="api-cockpit.html#cockpit-location-options" title="location.options"><code class="code">cockpit.location.options</code></a>.</p>
<p>This event is not triggered immediately during a <code class="code">location.go()</code> or
        similar call. It will be triggered asynchronously at a later time.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-jump"></a><h2>Jumping between components</h2>
<pre class="programlisting">
  cockpit.jump("/system/log")
</pre>
<p>In Cockpit in there multiple components shown. In order to tell Cockpit to jump to and show
      another component and a certain location within that component, use the
      <code class="code">cockpit.jump()</code> function. Stable component paths are documented. Don't assume
      you can navigate into paths that are not stable API.</p>
<div class="refsection">
<a name="cockpit-jump-jump"></a><h3>cockpit.jump()</h3>
<pre class="programlisting">
  cockpit.jump(path, [ host ])
</pre>
<p>Ask Cockpit to jump to another component. The location of the current component will
        not be affected. The <code class="code">path</code> argument can be a string path, starting with <code class="code">/</code>
        or an array containing the parts of a path that will be joined to create a path. If <code class="code">host</code>
        is not specified, then the component on the same host as the caller will be displayed. If
        host is null, then the host portion of the path will be removed, displaying the component on
        the host that cockpit is connected directly to. This is mostly useful for displaying a
        dashboard or other multi-machine components.</p>
<p>If the calling component is not running within Cockpit, or the calling component is not
        currently displayed, then the jump will not happen, and this function has no effect.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-spawn"></a><h2>Spawning Processes</h2>
<p>This is the API for spawning a process and receiving its output, as well
      as exit codes.</p>
<div class="refsection">
<a name="cockpit-spawn-spawn"></a><h3>cockpit.spawn()</h3>
<pre class="programlisting">
 process = cockpit.spawn(args, [options])
</pre>
<p>Spawns a process on the system.</p>
<p>The <code class="code">args</code> should be an array starting with the executable and
        containing all the arguments to pass on the command line. If <code class="code">args</code>
        is a string then it is interpreted as an executable name. The optional
        <code class="code">options</code> argument is a javascript plain object and can contain
        any of the following fields:
      </p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">"binary"</code></span></p></td>
<td><p>If set to <code class="code">true</code> then handle the input and output
            of the process as arrays of binary bytes.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"directory"</code></span></p></td>
<td><p>The directory to spawn the process in.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"err"</code></span></p></td>
<td><p>Controls where the standard error is sent. By default it is logged
            to the journal. If set to <code class="code">"out"</code> it is included in with the
            output data. If set to <code class="code">"ignore"</code> then the error output is discarded.
            When the <code class="code">"pty"</code> field is set, this field has no effect.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"host"</code></span></p></td>
<td><p>The remote host to spawn the process on. If no host is specified
            then the correct one will be automatically selected based on the page
            calling this function.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"environ"</code></span></p></td>
<td><p>An optional array that contains strings to be used as
            additional environment variables for the new process. These are
            <code class="code">"NAME=VALUE"</code> strings.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"pty"</code></span></p></td>
<td><p>Launch the process in its own PTY terminal, and send/receive
            terminal input and output.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"batch"</code></span></p></td>
<td><p>Batch data coming from the process in blocks of at least this
              size. This is not a guarantee. After a short timeout the data will be sent
              even if the data doesn't match the batch size. Defaults to zero.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"latency"</code></span></p></td>
<td><p> The timeout for flushing any cached data in milliseconds.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"superuser"</code></span></p></td>
<td>
<p>Set to <code class="code">"require"</code> to spawn the process as root instead of
              the logged in user. If the currently logged in user is not permitted to become root
              (eg: via <code class="code">pkexec</code>) then the <code class="code">client</code> will immediately be
  	      <a class="link" href="api-cockpit.html#cockpit-dbus-onclose" title="client.onclose">closed</a> with a <code class="code">"access-denied"</code>
              problem code.</p>
<p>Set to <code class="code">"try"</code> to try to run the process as root, but if that fails,
              fall back to an unprivileged process.</p>
</td>
</tr>
</tbody>
</table></div>
<p>The spawned process is a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        that will complete if the process exits successfully, or fail if there's a problem.
        Some additional methods besides the standard jQuery promise methods are documented
        below.</p>
<p>The standard output of the process is made available via the spawned process
        object. Any non-UTF8 output from the process will be coerced into textual form.
        It is highly recommended that only textual output be produced by the command.
        The standard error is logged to the journal.</p>
</div>
<div class="refsection">
<a name="cockpit-spawn-done"></a><h3>process.done()</h3>
<pre class="programlisting">
 process.done(function(data) { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        method. It sets up a handler to be called when the process finishes successfully.</p>
<p>The <code class="code">data</code> argument contains the standard output of the process.
        If it a string, unless the process was opened in binary mode, in which case the
        <code class="code">data</code> is an array of bytes. If a
        <code class="code"><a class="link" href="api-cockpit.html#cockpit-spawn-stream" title="process.stream()">process.stream()</a></code>
        handler is set up, then any standard output data consumed by the handler will not
        be included in the <code class="code">data</code> argument.</p>
</div>
<div class="refsection">
<a name="cockpit-spawn-fail"></a><h3>process.fail()</h3>
<pre class="programlisting">
 process.fail(function(exception[, data]) { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a> method.
        It sets up a handler to be called when the process fails, terminates or exits.</p>
<p>The <code class="code">exception</code> object passed to the handler can have the
        following fields:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">problem</code></span></p></td>
<td><p>A <a class="link" href="api-cockpit.html#cockpit-problems" title="Problem Codes">problem code</a> string when
            a problem occurred starting or communicating with the process. This is <code class="code">null</code>
            if the process exited or was terminated.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">exit_status</code></span></p></td>
<td><p>The numeric exit status of the process. This is <code class="code">null</code> if
            the process did not exit.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">exit_signal</code></span></p></td>
<td><p>A string representing a unix signal that caused the process to terminate.
            This is <code class="code">null</code> if the process did not terminate because of a signal.</p></td>
</tr>
</tbody>
</table></div>
<p>If the process actually ran and produced output before failing, it will be available in
        the <code class="code">data</code> argument. Otherwise this argument will be <code class="code">undefined</code>.</p>
</div>
<div class="refsection">
<a name="cockpit-spawn-always"></a><h3>process.always()</h3>
<pre class="programlisting">
 process.always(function() { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a> method.
        It sets up a handler to be called when when the process completes, whether it exits successfully,
        fails, terminates, or exits with a failure.</p>
</div>
<div class="refsection">
<a name="cockpit-spawn-stream"></a><h3>process.stream()</h3>
<pre class="programlisting">
 process.stream(function(data) { ... })
</pre>
<p>This sets up a handler to be called when the process has standard output. The
        handler will be called multiple times. The handler will be called regardless of
        whether the process ends up exiting successfully or not.</p>
<p>Only one handler may be registered at a time. Registering an additional handler
        replaces the previous one. The handler receives either string <code class="code">data</code> or
        an array of binary bytes as its argument. A stream handler may return a number, which
        indicates the number of characters or bytes consumed from <code class="code">data</code>. Any data
        not consumed will be included again the next time the handler is called.</p>
<p>If a <code class="code">process.stream()</code> handler is set up, then the
        <code class="code"><a class="link" href="api-cockpit.html#cockpit-spawn-done" title="process.done()">process.done()</a></code> handlers will
        only get any remaining data not consumed by the stream handler.</p>
</div>
<div class="refsection">
<a name="cockpit-spawn-input"></a><h3>process.input()</h3>
<pre class="programlisting">
 process.input(data, [stream])
</pre>
<p>This method writes <code class="code">data</code> to the standard input of the process.
        If <code class="code">data</code> is <code class="code">null</code> or <code class="code">undefined</code> it is not sent.
        The <code class="code">data</code> should be a string or an array of bytes if the process was
        opened in binary mode.</p>
<p>If <code class="code">stream</code> is set to <code class="code">true</code> then this function may be
        called again with further input. Otherwise the standard input of the process
        is closed.</p>
</div>
<div class="refsection">
<a name="cockpit-spawn-close"></a><h3>process.close()</h3>
<pre class="programlisting">
 process.close([problem])
</pre>
<p>Close the process. If <code class="code">problem</code> is specified it should be a
        standard <a class="link" href="api-cockpit.html#cockpit-problems" title="Problem Codes">problem code</a> string. In this case the
        process will be terminated with a signal.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-problems"></a><h2>Problem Codes</h2>
<p>Cockpit represents problems with standardized problem string codes.</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">"access-denied"</code></span></p></td>
<td><p>The user is not permitted to perform the action in question.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"authentication-failed"</code></span></p></td>
<td><p>User authentication failed.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"internal-error"</code></span></p></td>
<td><p>An unexpected internal error without further info. This should
          not happen during the normal course of operations.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"no-cockpit"</code></span></p></td>
<td><p>The system does not have a compatible version of Cockpit installed
          or installed properly.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"no-session"</code></span></p></td>
<td><p>Cockpit is not logged in.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"not-found"</code></span></p></td>
<td><p>Something specifically requested was not found, such as a file,
          executable etc.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"terminated"</code></span></p></td>
<td><p>Something was terminated forcibly, such as a connection, process
          session, etc.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"timeout"</code></span></p></td>
<td><p>Something timed out.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"unknown-hostkey"</code></span></p></td>
<td><p>The remote host had an unexpected or unknown key.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"no-forwarding"</code></span></p></td>
<td><p>Could not forward authentication credentials to the remote host.</p></td>
</tr>
</tbody>
</table></div>
<div class="refsection">
<a name="cockpit-messages"></a><h3>cockpit.message()</h3>
<pre class="programlisting">
 message = cockpit.message(problem)
 message = cockpit.message(exception)
</pre>
<p>Return a message for the <code class="code">exception</code> or <code class="code">problem</code> code
        passed as an argument. If the argument is an object with a <code class="code">"message"</code> property,
        as is the case with most exceptions, that will be returned directly. If the argument is
        an object with a <code class="code">"problem"</code> property, then it will be used as the problem code.
        An appropriate message will be returned for problem codes.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-dbus"></a><h2>DBus Access</h2>
<p>Cockpit allows access to DBus services via this API.</p>
<p>DBus values are represented as javascript values and objects as follows:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">BYTE 'y'</code></span></p></td>
<td><p>Javascript number.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">BOOLEAN 'b'</code></span></p></td>
<td><p>Javascript boolean.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">INT16 'n'</code></span></p></td>
<td><p>Javascript number.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">UINT16 'q'</code></span></p></td>
<td><p>Javascript number.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">INT32 'i'</code></span></p></td>
<td><p>Javascript number.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">UINT32 'u'</code></span></p></td>
<td><p>Javascript number.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">INT64 'x'</code></span></p></td>
<td><p>Javascript number.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">UINT64 't'</code></span></p></td>
<td><p>Javascript number.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">DOUBLE 'd'</code></span></p></td>
<td><p>Javascript number.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">STRING 's'</code></span></p></td>
<td><p>Javascript string.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">OBJECT_PATH 'o'</code></span></p></td>
<td><p>Javascript string.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">SIGNATURE 'g'</code></span></p></td>
<td><p>Javascript string.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">ARRAY of BYTE 'ay'</code></span></p></td>
<td><p>A string containing base64 encoded data.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">ARRAY of DICT_ENTRY with STRING keys 'a{s?}'</code></span></p></td>
<td><p>A javascript plain object with the keys as property names.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">ARRAY of DICT_ENTRY with other keys 'a{??}'</code></span></p></td>
<td><p>A javascript plain object each key JSON encoded into a string property name.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">ARRAY of other</code></span></p></td>
<td><p>A javascript array.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">VARIANT</code></span></p></td>
<td><p>A javascript plain object with the <code class="code">"t"</code> property set to a DBus type string,
            and the <code class="code">"v"</code> property set to a value.</p></td>
</tr>
</tbody>
</table></div>
<div class="refsection">
<a name="cockpit-dbus-dbus"></a><h3>cockpit.dbus()</h3>
<pre class="programlisting">
 client = cockpit.dbus(name, [options])
</pre>
<p>Create a DBus client for the given bus <code class="code">name</code> (eg: service name). Use the
        following functions to make DBus method calls, watch for events, etc. The optional
        <code class="code">options</code> argument is a javascript plain object, and may include:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">"bus"</code></span></p></td>
<td><p>The DBus bus to connect to. Specifying <code class="code">"session"</code> will
              connect to the DBus user session bus, <code class="code">"user"</code> will connect to the
              user bus (on some systems this is identical to the session bus), and <code class="code">"system"</code>
              will connect to the DBus system bus. This defaults to "system" if not
              present.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"host"</code></span></p></td>
<td><p>The host to open the channel to. If no host is specified
            then the correct one will be automatically selected based on the page
            calling this function.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"superuser"</code></span></p></td>
<td>
<p>Set to <code class="code">"require"</code> to talk to this service as root.
            The DBus service will see the DBus method calls and accesses as coming from root,
            rather than the logged in user. This is useful for talking to services that do not
            correctly use <a class="ulink" href="http://www.freedesktop.org/software/polkit" target="_top">polkit</a>
            to authorize administrative users. If the currently logged in user is not
            permitted to become root (eg: via <code class="code">pkexec</code>) then the <code class="code">client</code> will
            immediately be <a class="link" href="api-cockpit.html#cockpit-dbus-onclose" title="client.onclose">closed</a> with a
            <code class="code">"access-denied"</code> problem code.</p>
<p>Set to <code class="code">"try"</code> to try to talk as root, but if that fails,
            fall back to unprivileged.</p>
</td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"track"</code></span></p></td>
<td><p>It is valid for a DBus service to exit, and be restarted in such a
            way that clients continue to talk to it across the restart. Some services are not
            written with this in mind. If the <code class="code">"track"</code> option is set to
            <code class="code">true</code> then the channel will close when the service exits and/or disconnects
            from the DBus bus.</p></td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsection">
<a name="cockpit-dbus-close"></a><h3>client.close()</h3>
<pre class="programlisting">
 client.close([problem])
</pre>
<p>Close the DBus client. If <code class="code">problem</code> is specified it should be a
        <a class="link" href="api-cockpit.html#cockpit-problems" title="Problem Codes">problem code</a> string.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-onclose"></a><h3>client.onclose</h3>
<pre class="programlisting">
 $(client).on("close", function(options) { ... })
</pre>
<p>An event triggered when the DBus client closes. This can happen either because
        <a class="link" href="api-cockpit.html#cockpit-dbus-close" title="client.close()">client.close()</a> function was called,
        or the DBus service went away, or some other problem or disconnection.</p>
<p>The <code class="code">options</code> will contain various close information, including a
        <code class="code">"problem"</code> field which will be set if the channel was closed because
        of a problem.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-onowned"></a><h3>client.onowner</h3>
<pre class="programlisting">
 $(client).on("owner", function(event, owner) { ... })
</pre>
<p>An event triggered when the owner of the DBus name changes. The owner
        value will be the id of the name owner on the bus or null if the name
        is unowned. The absence of an owner should not be treated as a disconnection.
        However this makes it possible to take some action based on the
        actual status of the service, for example disconnecting a pending signal handler.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-options"></a><h3>client.options</h3>
<p>Set to the options used when creating the client. Will not change for the life of
        the client.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy"></a><h3>client.proxy</h3>
<pre class="programlisting">
 proxy = client.proxy([interface, path])
</pre>
<p>Create proxy javascript object for a DBus <code class="code">interface</code>. At the
        specified DBus object <code class="code">path</code>. The proxy will have
        properties, methods and signals from to the DBus interface, and allows for
        natural interaction. If no <code class="code">interface</code> is specified then the DBus
        bus name of the client is used. If no <code class="code">path</code> is specified, then
        the DBus name of the client is converted to a path.</p>
<p>If creating lots of proxies for a given <code class="code">interface</code> it is more
        efficient to use the
        <a class="link" href="api-cockpit.html#cockpit-dbus-proxies" title="client.proxies"><code class="code">client.proxies()</code></a>
        function.</p>
<p>The proxy is loaded when the
        <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-valid" title="proxy.valid"><code class="code">proxy.valid</code></a> field is
        <code class="code">true</code>, and it is set to <code class="code">false</code> if the underlying
        <code class="code">interface</code> and/or <code class="code">path</code> don't or no longer exist, or
        the <code class="code">client</code> has closed. You can wait for proxy to become valid
        by passing a callback to its
        <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-wait" title="proxy.wait()"><code class="code">proxy.wait()</code></a> function.
        The <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-onchanged" title="proxy.onchanged"><code class="code">proxy.onchanged</code></a>
        event will also fire when the proxy becomes valid or invalid. DBus properties and
        methods on the proxy are not defined until the proxy becomes valid.</p>
<pre class="programlisting">
 value = proxy.Prop1
 proxy.WritableProp = value
</pre>
<p>All DBus properties on the <code class="code">interface</code> that start with an upper case
        letter (as is convention) will be automatically defined on this proxy, and will update
        their values as the DBus property values change. In addition the
        <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-onchanged" title="proxy.onchanged"><code class="code">proxy.onchanged</code></a> event
        will fire every time the properties change.</p>
<p>If you assign a value to a writable property on the proxy, the proxy will try to set
        that property on the DBus <code class="code">interface</code> at <code class="code">path</code>. The actual proxy
        property value will not update until the DBus service has notified the proxy of the
        change. If setting a property fails a warning will be logged. In order to have more
        reliable setting of properties, or track when they have been set, or if setting fails,
        use the <a class="link" href="api-cockpit.html#cockpit-dbus-call" title="client.call()"><code class="code">client.call()</code></a> directly.
        It should be noted that DBus service implementations may also be inconsistent in
        their behavior when setting a property fails.</p>
<p>You can access the raw property data using the
        <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-data" title="proxy.data"><code class="code">proxy.data</code></a> field, including
        data for properties that do not start with an upper case letter.</p>
<pre class="programlisting">
  proxy.Method(arg1, arg2)
     .done(function(retval1, retval2) {
        ...
     })
     .fail(function(ex) {
        ...
     });
</pre>
<p>All DBus methods on the <code class="code">interface</code> that start with an upper case
        letter (as is convention) will be automatically defined on this proxy. These
        methods are called with arguments as normal javascript arguments. A
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        that will complete successfully when the method returns, or fail if an error occurs.
        The return values from the DBus method will be passed to the <code class="code">done</code> handler
        function directly.</p>
<p>Methods that do not start with an upper case letter can be invoked by using
        the usual <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-call" title="proxy.call()"><code class="code">proxy.call()</code></a> directly.</p>
<pre class="programlisting">
  $(proxy).on("Signal", function(event, arg1, arg2) {
      ...
  }(;
</pre>
<p>All DBus signals on the <code class="code">interface</code> that start with an upper case
        letter (as is convention) will be automatically emit events on this proxy. These
        events will contain the signal arguments after the standard <code class="code">event</code>
        argument.</p>
<p>Signals that do not start with an upper case letter can be subscribed to by
        using <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-signal" title="proxy.onsignal"><code class="code">proxy.onsignal</code></a>
        directly.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy-client"></a><h3>proxy.client</h3>
<p>Set to the DBus client of the proxy. Will not change for the life of
        the proxy.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy-path"></a><h3>proxy.path</h3>
<p>Set to the DBus object path of the proxy. Will not change for the life of
        the proxy.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy-iface"></a><h3>proxy.iface</h3>
<p>Set to the DBus interface name of the proxy. Will not change for the life
        of the proxy.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy-valid"></a><h3>proxy.valid</h3>
<p>Set to <code class="code">true</code> when the proxy's DBus interface is present at its
        DBus path, and all information for the proxy has loaded. Is set to <code class="code">false</code>
        while loading, and after the proxy no longer refers a DBus interface and path.
        Also set to <code class="code">false</code> if the <code class="code">client</code> closes.</p>
<p>Use the by <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-wait" title="proxy.wait()"><code class="code">proxy.wait()</code></a>
        function to wait for a proxy to load. The
        <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-onchanged" title="proxy.onchanged"><code class="code">proxy.onchanged</code></a>
        event will also be emitted when the proxy becomes valid or invalid. DBus properties and
        methods on the proxy are not defined until the proxy becomes valid.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy-data"></a><h3>proxy.data</h3>
<p>A plain javascript object containing all the raw property data that this
        proxy has loaded. This will be updated automatically as the proxy is notified
        of property changes from the DBus service. The
        <a class="link" href="api-cockpit.html#cockpit-dbus-proxy-onchanged" title="proxy.onchanged"><code class="code">proxy.onchanged</code></a>
        event will be emitted when it changes.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy-call"></a><h3>proxy.call()</h3>
<pre class="programlisting">
 invocation = proxy.call(method, args, [options])
</pre>
<p>Make a DBus method call on this proxy.</p>
<p>For DBus methods that start with an upper case letter, is usually more convenient
        <a class="link" href="api-cockpit.html#cockpit-dbus-proxy" title="client.proxy">to call the method directly on the proxy</a>.
        However if methods that do not follow the usual DBus convention,
        or specify additional options, or the caller cannot be sure that the method actually
        exists, you can use this method.</p>
<p>This function also works on proxies that have are still loading and have not
        become valid yet.</p>
<p>The <code class="code">method</code> should be a DBus method name, and the <code class="code">args</code>
        should be an array of arguments to pass to the method. The <code class="code">options</code>
        are <a class="link" href="api-cockpit.html#cockpit-dbus-call" title="client.call()">described elsewhere</a>.</p>
<p>The returned value is identical to the one returned from
        <a class="link" href="api-cockpit.html#cockpit-dbus-call" title="client.call()">client.call()</a>. It is a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        that will complete successfully when the method returns, or fail if an error occurs.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy-wait"></a><h3>proxy.wait()</h3>
<pre class="programlisting">
 proxy.wait(function() {
   ...
 });
</pre>
<p>Wait for a proxy to finish loading, and invoke the callback function when ready.
        If this method is called after a proxy has already loaded, then the callback will
        be invoked immediately. Use <code class="code">proxy.valid</code> to determine whether the proxy
        loading resulting in a valid proxy.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy-onchanged"></a><h3>proxy.onchanged</h3>
<pre class="programlisting">
 $(proxy).on("changed", function(data) {
   ...
 });
</pre>
<p>This event is emitted when the proxy's properties change.</p>
<p>The <code class="code">data</code> has the following form, and will only include
        properties that have changed:</p>
<pre class="programlisting">
  {
    "Prop1": "value",
    "Prop2": 5
  }
</pre>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxy-signal"></a><h3>proxy.onsignal</h3>
<pre class="programlisting">
 $(proxy).on("signal", function(event, name, args) {
   ...
 });
</pre>
<p>This event is emitted when the proxy's emits an event.</p>
<p>For most events, that have names which start with an upper case letter, you can
        just <a class="link" href="api-cockpit.html#cockpit-dbus-proxy" title="client.proxy">connect to that event as a signal directly</a>.
        However if you wish to be notified when any signal is emitted, or for signals that do not
        follow the usual DBus convention, you can connect to this event.</p>
<p>The <code class="code">name</code> is the DBus signal name, and the <code class="code">args</code> is an array
        of arguments that were emitted with the signal.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxies"></a><h3>client.proxies</h3>
<pre class="programlisting">
  proxies = client.proxies([interface], [path_namespace])
</pre>
<p>Create <a class="link" href="api-cockpit.html#cockpit-dbus-proxy" title="client.proxy">proxy javascript objects</a> for
        a DBus interfaces. The proxes will have properties, methods and signals from
        the DBus <code class="code">interface</code>, and allow for natural interaction. If no
        <code class="code">interface</code> is specified then the DBus bus name of the client is used.
        If no <code class="code">path_namespace</code> is provided then <code class="code">"/"</code> will be used.</p>
<p>Proxies will be automatically created for instances of the
        <code class="code">interface</code> available at the DBus service. The optional
        <code class="code">path_namespace</code> argument can be used to restrict the proxies for
        instances that have DBus paths which have the namespace path prefix.</p>
<pre class="programlisting">
  proxy1 = proxies["/dbus/path1"];
  proxy2 = proxies["/dbus/path2"];
  for (proxy in proxies) {
    ...
  }
</pre>
<p>The returned <code class="code">proxies</code> object will is used as a dictionary,
        and will have values containing proxies for DBus interface instances, with the
        keys being the DBus paths of those instances. It is possible to enumerate over
        the returned <code class="code">proxies</code>.</p>
<p>Proxies will be automatically added and removed from the <code class="code">proxies</code>
        object as they appear and disappear in the service. The
        <a class="link" href="api-cockpit.html#cockpit-dbus-proxies-onadded" title="proxies.onadded"><code class="code">proxies.onadded</code></a>
        and <a class="link" href="api-cockpit.html#cockpit-dbus-proxies-onremoved" title="proxies.onremoved"><code class="code">proxies.onremoved</code></a>
        events will be emitted. DBus services may not support notifications of paths
        disappearing.</p>
<p>Use the <code class="code">proxies.wait()</code> function to be notified when the initial
        set of proxies has been populated.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxies-wait"></a><h3>proxies.wait()</h3>
<pre class="programlisting">
 proxies.wait(function() {
   ...
 });
</pre>
<p>Wait for a <code class="code">proxies</code> object to populate its initial set of proxies.
        If this method is called after the proxies have populated, the callback will be
        invoked immediately.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxies-client"></a><h3>proxies.client</h3>
<p>Set to the DBus client of the proxies. Will not change.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxies-iface"></a><h3>proxies.iface</h3>
<p>Set to the DBus interface name of the proxies. Will not change.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxies-path_namespace"></a><h3>proxies.path_namespace</h3>
<p>Set to the DBus path namespace used which the proxies must have as a DBus
        path prefix. Will not change.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxies-onadded"></a><h3>proxies.onadded</h3>
<pre class="programlisting">
 $(proxies).on("added", function(event, proxy) {
   ...
 })
</pre>
<p>This event is emitted when a proxy is added to the <code class="code">proxies</code> object.
        The proxy will already have loaded.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxies-onchanged"></a><h3>proxies.onchanged</h3>
<pre class="programlisting">
 $(proxies).on("changed", function(event, proxy) {
   ...
 })
</pre>
<p>This event is emitted when one of the proxy in the <code class="code">proxies</code> object
        changes its properties.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-proxies-onremoved"></a><h3>proxies.onremoved</h3>
<pre class="programlisting">
 $(proxies).on("removed", function(event, proxy) {
   ...
 })
</pre>
<p>This event is emitted when a proxy is removed to the <code class="code">proxies</code> object.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-call"></a><h3>client.call()</h3>
<pre class="programlisting">
  invocation = client.call(path, interface, method, args, [options])
</pre>
<p>Make a DBus method call.</p>
<p>The <code class="code">path</code> is the DBus object path to make
        the call on, <code class="code">interface</code> is the DBus interface for the method and
        <code class="code">method</code> is the name of the method to call. The <code class="code">args</code> is an
        array of arguments to pass to the method, each of which must be appropriate for the
        expected <a class="link" href="api-cockpit.html#cockpit-dbus" title="DBus Access">DBus type</a> of that argument. The
        <code class="code">args</code> may be <code class="code">null</code> if no arguments are to be sent.</p>
<p>The returned value is a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        that will complete successfully when the method returns, or fail if an error occurs.</p>
<p>If <code class="code">options</code> is specified it should be a plain javascript object,
        which may contain the following properties:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">flags</code></span></p></td>
<td><p>A string containing DBus message flags. No flags are defined at
            this time.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">type</code></span></p></td>
<td><p>A valid DBus type signature to use when calling the method. In the
              absence of this, the DBus service will be introspected (and the result cached) to
              ask what the method type signature is.</p></td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsection">
<a name="cockpit-dbus-done"></a><h3>invocation.done()</h3>
<pre class="programlisting">
 invocation.done(function(args, options) { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        method. It sets up a handler to be called when the DBus method call finishes
        successfully.</p>
<p>The <code class="code">args</code> argument is an array of return values from the DBus method.
        Each of them will be converted to an appropriate
        <a class="link" href="api-cockpit.html#cockpit-dbus" title="DBus Access">javascript type</a>.</p>
<p>The <code class="code">options</code> argument may contain additional information about the
        reply. If the <code class="code">type</code> option was specified when performing the method call,
        then the <code class="code">options</code> in the reply here will also contain a <code class="code">type</code>
        field containing the DBus type signature of the output. If the <code class="code">flags</code> option
        was specified when performing the call then the <code class="code">options</code> in the reply here
        will contain message flags. Possible out message flags are:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">&gt;</code></span></p></td>
<td><p>A big endian message.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">&lt;</code></span></p></td>
<td><p>A little endian message.</p></td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsection">
<a name="cockpit-dbus-fail"></a><h3>invocation.fail()</h3>
<pre class="programlisting">
 invocation.fail(function(exception) { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a> method.
        It sets up a handler to be called when the DBus method call fails.</p>
<p>The <code class="code">exception</code> object passed to the handler can have the
        following properties:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">problem</code></span></p></td>
<td><p>A <a class="link" href="api-cockpit.html#cockpit-problems" title="Problem Codes">problem code</a> string when
              a problem occurred starting or communicating with the DBus service. This is
              <code class="code">null</code> in the cases where an actual DBus error was occurred.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">name</code></span></p></td>
<td><p>The DBus error name. This will be <code class="code">null</code> in cases where the
            failure was not due to a DBus error.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">message</code></span></p></td>
<td><p>A DBus error message. This will be <code class="code">null</code> in cases where the
            failure was not due to a DBus error.</p></td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsection">
<a name="cockpit-dbus-always"></a><h3>invocation.always()</h3>
<pre class="programlisting">
 invocation.always(function() { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a> method.
        It sets up a handler to be called when when the DBus method call finishes whether successfully,
        or fails.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-subscribe"></a><h3>client.subscribe()</h3>
<pre class="programlisting">
 subscription = client.subscribe(match, function(path, interface, signal, args) { ... })
</pre>
<p>Subscribe to signals. The <code class="code">match</code> argument is a javascript plain object which
        defines what signals to subscribe to. Each property in the <code class="code">match</code> argument restricts
        signals subscribed to. If a property is not present then it is treated as a wildcard, matching
        anything. If an empty object is specified as <code class="code">match</code> then all signals will be
        subscribed to. The <code class="code">match</code> argument may contain the following properties:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">interface</code></span></p></td>
<td><p>A DBus interface to match.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">path</code></span></p></td>
<td><p>A DBus object path to match. May not be used together with the
            <code class="code">path_namespace</code> property. It should be a valid DBus object path,
            that is, it should have no trailing slash.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">path_namespace</code></span></p></td>
<td><p>A DBus object path prefix to match. Any paths in the hierarchy below this
            top path will match. May not be used together with the <code class="code">path</code>
            property.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">member</code></span></p></td>
<td><p>The DBus signal name to match.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">arg0</code></span></p></td>
<td><p>Matches the first argument of a DBus message, which must be a
             string.</p></td>
</tr>
</tbody>
</table></div>
<p>The handler passed as the second argument will be invoked when the signal is received.
        A <code class="code">subscription</code> is returned which can be used to remove the subscription by
        calling its <code class="code">subscription.remove()</code> method.</p>
<p>It is not a problem to subscribe to the same signals more than once, with identical
        or slightly different <code class="code">match</code> arguments.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-remove"></a><h3>subscription.remove()</h3>
<pre class="programlisting">
 subscription.remove()
</pre>
<p>Unsubscribe from the DBus signal subscription.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-watch"></a><h3>client.watch</h3>
<pre class="programlisting">
 watch = client.watch(path)
 watch = client.watch({ "path_namespace": path_namespace, "interface": interface })
</pre>
<p>Watch for property and interface changes on the given DBus object
        <code class="code">path</code> DBus <code class="code">path_namespace</code>. If <code class="code">interface</code> is
        specified only properties on that DBus interface will be watched.</p>
<p>The <a class="link" href="api-cockpit.html#cockpit-dbus-proxy" title="client.proxy"><code class="code">client.proxy()</code></a> and
          <a class="link" href="api-cockpit.html#cockpit-dbus-proxies" title="client.proxies"><code class="code">client.proxies()</code></a> functions and
        the objects they return are high level wrappers around <code class="code">client.watch()</code>.</p>
<p>The property and interface changes will be available in raw form on the
        <a class="link" href="api-cockpit.html#cockpit-dbus-onnotify" title="client.onnotify"><code class="code">client.onnotify</code></a> event.</p>
<p>Property and interface changes that are caused by a method call or signal will
        show up before that method call reply is received, or signal event is triggered.
        It should be possible to rely on this guarantee, unless the DBus service in question
        behaves incorrectly. Internally these watches work well with code that implements the
        <a class="ulink" href="http://dbus.freedesktop.org/doc/dbus-specification.html#standard-interfaces-objectmanager" target="_top">ObjectManager</a>
        portion of the DBus specification. If no ObjectManager implementation is available, the
        watch falls back to using DBus
        <a class="ulink" href="http://dbus.freedesktop.org/doc/dbus-specification.html#standard-interfaces-introspectable" target="_top">Introspection</a> along with the usual
        <a class="ulink" href="http://dbus.freedesktop.org/doc/dbus-specification.html#standard-interfaces-properties" target="_top">PropertiesChanged</a> signal. If the DBus service implements none of these, or implements them in an
        inconsistent manner, then this function will provide inconsistent or unexpected
        results.</p>
<p>The parameter is either a DBus <code class="code">path</code> or a plain javascript object
        with zero or more of the following fields. If an empty javascript object is used as
        an argument, then all paths, interfaces and properties will be watched.</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">interface</code></span></p></td>
<td><p>Watch properties on this DBus interface.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">path</code></span></p></td>
<td><p>Watch interfaces and properties at this DBus path. May not be
              used together with the <code class="code">path_namespace</code> property.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">path_namespace</code></span></p></td>
<td><p>Watch interfaces and properties under this DBus path. It should
              be a valid DBus object path, that is, it should have no trailing slash.
              If an ObjectManager implementation is available at this interface, then it
              is used. May not be used together with the <code class="code">path</code> property.</p></td>
</tr>
</tbody>
</table></div>
<p>The returned value is a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        that will complete successfully when the watch has populated its initial set of properties
        and interfaces, and these have been notified via
        <a class="link" href="api-cockpit.html#cockpit-dbus-onnotify" title="client.onnotify"><code class="code">client.onnotify</code></a>.</p>
<p>A watch can be removed by calling the
        <a class="link" href="api-cockpit.html#cockpit-dbus-watch-remove" title="watch.remove()"><code class="code">watch.remove()</code></a> method on
        the returned value. If identical watches are added more than once, then they must
        also be removed the same number of times before the removal takes effect.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-watch-done"></a><h3>watch.done()</h3>
<pre class="programlisting">
 watch.done(function() { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        method. It sets up a handler to be called when the watch has populated its initial
        properties and interfaces.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-watch-fail"></a><h3>watch.fail()</h3>
<pre class="programlisting">
 watch.fail(function() { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        method. It sets up a handler to be called if the watch fails to populate its initial
        properties and interfaces. Note that a watch will only fail if the DBus client
        closes or is somehow disconnected. It does not fail in the case of missing
        interfaces or properties.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-watch-always"></a><h3>watch.always()</h3>
<pre class="programlisting">
 watch.always(function() { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        method. It sets up a handler to be called when the watch has populated its initial
        properties and interfaces or has failed to do so.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-watch-remove"></a><h3>watch.remove()</h3>
<pre class="programlisting">
 watch.remove()
</pre>
<p>Remove the watch. This may not have any immediate effect if other watches are in
        place. In particular, if identical watches are added more than once, then they must
        also be removed the same number of times before the removal takes effect.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-onnotify"></a><h3>client.onnotify</h3>
<pre class="programlisting">
 $(client).on("notify", function(data) { ... })
</pre>
<p>An event triggered when
        <a class="link" href="api-cockpit.html#cockpit-dbus-watch" title="client.watch">watched</a> properties or interfaces change.</p>
<p>The <a class="link" href="api-cockpit.html#cockpit-dbus-proxy" title="client.proxy"><code class="code">client.proxy()</code></a> and
          <a class="link" href="api-cockpit.html#cockpit-dbus-proxies" title="client.proxies"><code class="code">client.proxies()</code></a> functions and
          the objects they return are high level wrappers around the <code class="code">data</code> provided
          by this event.</p>
<p>The <code class="code">data</code> has the following form:</p>
<pre class="programlisting">
  {
      "/path1": {
         "org.Interface1": {
            "Prop1": "value",
            "Prop2": 5
         },
         "org.Interface2": null
      }
  }
</pre>
<p>Multiple paths may be present, each of which may have multiple interfaces, each
        of which may have multiple properties. The first time a given path and interface is
        emitted from this signal, it will have all its properties and interfaces. Thereafter
        only changes are noted. If an interface is set to <code class="code">null</code>, then that
        interface has disappeared.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-notify"></a><h3>client.notify</h3>
<pre class="programlisting">
  client.notify(data)
</pre>
<p>Emits a synthetic <a class="link" href="api-cockpit.html#cockpit-dbus-onnotify" title="client.onnotify"><code class="code">notify</code></a> event.
    The <code class="code">data</code> argument should follow the same layout as
    described for the <code class="code">notify</code> event.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-variant"></a><h3>cockpit.variant()</h3>
<pre class="programlisting">
 variant = cockpit.variant(type, value)
</pre>
<p>A DBus variant is represented as a plain javascript object with a
        <code class="code">"t"</code> property represesting the full DBus type of the variant,
        and a <code class="code">"v"</code> property containing the variant value.</p>
<p>This is a helper function for creating such a variant object.</p>
</div>
<div class="refsection">
<a name="cockpit-dbus-byte-array"></a><h3>cockpit.byte_array()</h3>
<pre class="programlisting">
 byte_array = cockpit.byte_array(value)
</pre>
<p>A DBus byte array is represented as base64 data encoded in a string. This
        is a helper function for creating such a byte array.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-http"></a><h2>HTTP Access</h2>
<p>Cockpit allows access to local HTTP and REST services via this API.</p>
<p>This is not a general purpose HTTP request API. In particular in only accesses unix sockets
      and localhost ports on the server. Use your browser's <code class="code">XmlHttpRequest</code> API for other
      more general HTTP access.</p>
<div class="refsection">
<a name="cockpit-http-constructor"></a><h3>cockpit.http()</h3>
<pre class="programlisting">
 http = cockpit.http(endpoint, [options])
 http = cockpit.http(options)
</pre>
<p>Create a new HTTP client. The <code class="code">endpoint</code> can be a file path starting with
        <code class="code">/</code> to connect to a unix socket, or it can be a port number to connect to on
        <code class="code">localhost</code>.</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">"connection"</code></span></p></td>
<td><p>A connection identifier. Subsequent channel requests with the same
            identifier will try to use the same connection if it is still open.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"superuser"</code></span></p></td>
<td>
<p>Set to <code class="code">"require"</code> to open this channel as root. If the
            currently logged in user is not permitted to become root (eg: via <code class="code">pkexec</code>)
            then the <code class="code">channel</code> will immediately be
            <a class="link" href="api-cockpit.html#cockpit-channels-close-ev" title="channel.onclose">closed</a> with a <code class="code">"access-denied"</code>
            problem code.</p>
<p>Set to <code class="code">"try"</code> to try to make the request as root, but if that fails,
            fall back to perform an unprivileged request.</p>
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsection">
<a name="cockpit-http-get"></a><h3>http.get()</h3>
<pre class="programlisting">
  request = http.get(path, [params, [headers]])
</pre>
<p>Perform an HTTP GET request for the given <code class="code">path</code>. If the <code class="code">params</code>
        is specified it should be a plain javascript object, which will be turned into a query string.</p>
<p>Optionally a plain javascript object containing headers can be included in the
        <code class="code">headers</code> argument.</p>
<p>The return value is a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        that will complete if the request happens successfully, or fail if there's a problem.</p>
</div>
<div class="refsection">
<a name="cockpit-http-post"></a><h3>http.post()</h3>
<pre class="programlisting">
  request = http.post(path, body, [headers])
</pre>
<p>Perform an HTTP POST request for the given <code class="code">path</code>. The <code class="code">body</code>
        can be a string, or a javascript plain object, which will be encoded as JSON data. If
        <code class="code">body</code> is <code class="code">undefined</code> or <code class="code">null</code> then an empty HTTP body
        will be sent.</p>
<p>Optionally a plain javascript object containing headers can be included in the
        <code class="code">headers</code> argument.</p>
<p>The return value is a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        that will complete if the request happens successfully, or fail if there's a problem.</p>
</div>
<div class="refsection">
<a name="cockpit-http-request"></a><h3>http.request()</h3>
<pre class="programlisting">
  request = http.request(options)
</pre>
<p>Perform an HTTP request. The <code class="code">options</code> can contain the following:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">"body"</code></span></p></td>
<td><p>The HTTP request body. If you do not specify a body, then you must
            call <a class="link" href="api-cockpit.html#cockpit-http-input" title="request.input()">request.input()</a> to complete the body
            and allow the request to start.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"headers"</code></span></p></td>
<td><p>A javascript plain object containing HTTP headers.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"method"</code></span></p></td>
<td><p>The HTTP method. Defaults to <code class="code">"GET"</code>.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"params"</code></span></p></td>
<td><p>A javascript plain object containing query string parameters.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"path"</code></span></p></td>
<td><p>The HTTP path. Defaults to <code class="code">/</code>.</p></td>
</tr>
</tbody>
</table></div>
<p>The return value is a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        that will complete if the request happens successfully, or fail if there's a problem.</p>
</div>
<div class="refsection">
<a name="cockpit-http-done"></a><h3>request.done()</h3>
<pre class="programlisting">
 request.done(function(data) { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>
        method. It sets up a handler to be called when the request finishes successfully.</p>
<p>The <code class="code">data</code> argument contains the body result of the request.
        If it a string, unless the process was opened in binary mode, in which case the
        <code class="code">data</code> is an array of bytes. If a
        <code class="code"><a class="link" href="api-cockpit.html#cockpit-http-stream" title="request.stream()">request.stream()</a></code>
        handler is set up, then any standard output data consumed by the handler will not
        be included in the <code class="code">data</code> argument.</p>
</div>
<div class="refsection">
<a name="cockpit-http-fail"></a><h3>request.fail()</h3>
<pre class="programlisting">
 request.fail(function(exception[, data]) { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a> method.
        It sets up a handler to be called when the request fails, or returns an error code.</p>
<p>The <code class="code">exception</code> object passed to the handler can have the
        following fields:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">problem</code></span></p></td>
<td><p>A <a class="link" href="api-cockpit.html#cockpit-problems" title="Problem Codes">problem code</a> string when
            a problem occurred starting or communicating with the server. This is <code class="code">null</code>
            if the process exited or was terminated.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">status</code></span></p></td>
<td><p>The numeric status of the response. This is <code class="code">null</code> if
            no response was received.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">reason</code></span></p></td>
<td><p>A string reason returned in the response. This is <code class="code">null</code> if
            no response was received.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">message</code></span></p></td>
<td><p>A string message returned in the response. This is <code class="code">null</code> if
            no response was received.</p></td>
</tr>
</tbody>
</table></div>
<p>If the request returned a response body, it will be available in
        the <code class="code">data</code> argument. Otherwise this argument will be <code class="code">undefined</code>.</p>
</div>
<div class="refsection">
<a name="cockpit-http-always"></a><h3>request.always()</h3>
<pre class="programlisting">
 request.always(function() { ... })
</pre>
<p>This is a standard
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a> method.
        It sets up a handler to be called when when the process completes, whether it exits successfully,
        fails, terminates, or exits with a failure.</p>
</div>
<div class="refsection">
<a name="cockpit-http-response"></a><h3>request.response()</h3>
<pre class="programlisting">
 request.response(function(status, headers) { ... })
</pre>
<p>This sets up a handler to be called when the HTTP request gets the initial response
        from the server. The <code class="code">status</code> argument is the HTTP status integer, and the
        <code class="code">headers</code> is a plain javascript object containing the headers of the
        response.</p>
</div>
<div class="refsection">
<a name="cockpit-http-stream"></a><h3>request.stream()</h3>
<pre class="programlisting">
 request.stream(function(data) { ... })
</pre>
<p>This sets up a handler to be called when the request returns output data. The
        handler will be called multiple times.</p>
<p>Only one handler may be registered at a time. Registering an additional handler
        replaces the previous one. The handler receives either string <code class="code">data</code> or
        an array of binary bytes as its argument. A stream handler may return a number, which
        indicates the number of characters or bytes consumed from <code class="code">data</code>. Any data
        not consumed will be included again the next time the handler is called.</p>
<p>If a <code class="code">request.stream()</code> handler is set up, then the
        <code class="code"><a class="link" href="api-cockpit.html#cockpit-http-done" title="request.done()">request.done()</a></code> handlers will
        only get any remaining data not consumed by the stream handler.</p>
</div>
<div class="refsection">
<a name="cockpit-http-input"></a><h3>request.input()</h3>
<pre class="programlisting">
 request.input(data, [stream])
</pre>
<p>This method writes <code class="code">data</code> to the HTTP request body. It is only valid
        if no <code class="code">"body"</code> has been specified in
        <a class="link" href="api-cockpit.html#cockpit-http-request" title="http.request()">http.request()</a> options. If <code class="code">stream</code>
        is <code class="code">true</code> then this function can be called again to provide further data.</p>
</div>
<div class="refsection">
<a name="cockpit-http-close"></a><h3>request.close()</h3>
<pre class="programlisting">
 request.close([problem])
</pre>
<p>Cancel the request. If <code class="code">problem</code> is specified it should be a
        standard <a class="link" href="api-cockpit.html#cockpit-problems" title="Problem Codes">problem code</a> string.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-permission"></a><h2>Permission Lookup</h2>
<p>Cockpit provides a mechanism for checking if the current user satisfies a
      given criteria. Currently capable of checking for root users, and group
      membership. This is meant for updating UI elements based on what actions the
      user can perform. It is <span class="emphasis"><em>not an access control mechanism</em></span>.</p>
<div class="refsection">
<a name="cockpit-permission-constructor"></a><h3>cockpit.permission()</h3>
<pre class="programlisting">
 permission = cockpit.permission([options])
</pre>
<p>Create a new permission object to check if the current user has permission.
        The "root" user is always given permission. The <code class="code">options</code> argument
        can contain a <code class="code">"group"</code> field, and members of that group are also
        given permission.</p>
</div>
<div class="refsection">
<a name="cockpit-permission-allowed"></a><h3>permission.allowed</h3>
<p>A boolean value which indicates if the permission is allowed or not. This will
        be <code class="code">null</code> if the permission is unknown, or there was an error checking
        the permission or the the permission data has not yet loaded. This property will update
        asynchronously and if you wish to be notified of changes connect to the
        <a class="link" href="api-cockpit.html#cockpit-permission-changed" title="permission.onchanged">permission.onchanged</a> event.</p>
</div>
<div class="refsection">
<a name="cockpit-permission-changed"></a><h3>permission.onchanged</h3>
<pre class="programlisting">
  $(permission).on("changed", function() { ... })
</pre>
<p>This event is fired when the permission changes. In particular the
        <a class="link" href="api-cockpit.html#cockpit-permission-allowed" title="permission.allowed">permission.allowed</a> property.</p>
</div>
<div class="refsection">
<a name="cockpit-permission-close"></a><h3>permission.close()</h3>
<pre class="programlisting">
  permission.close()
</pre>
<p>Closes the permission object and tears down any registered callbacks and dbus subscriptions.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-locale"></a><h2>Localization</h2>
<p>Cockpit provides a
      <a class="ulink" href="https://www.gnu.org/software/gettext/" target="_top"><code class="code">gettext()</code></a> like
      API for easy translation of strings.</p>
<div class="refsection">
<a name="cockpit-locale-language"></a><h3>cockpit.language</h3>
<p>The current locale language code. This is set based on the
        <a class="link" href="api-cockpit.html#cockpit-locale-locale" title="cockpit.locale()"><code class="code">cockpit.locale()</code></a> data loaded.</p>
</div>
<div class="refsection">
<a name="cockpit-locale-locale"></a><h3>cockpit.locale()</h3>
<pre class="programlisting">
 cockpit.locale(po)
</pre>
<p>Load locale information for a given <code class="code">po</code> data. The data should
        be JSON data in the <a class="ulink" href="https://www.npmjs.org/package/po2json" target="_top">po2json</a>
        format. The data will be loaded globally. If <code class="code">po</code> data has already been
        loaded, then this will extend that loaded data with additional strings. Any identical
        translations strings will be replaced with the new strings.</p>
<p>Various methods such as
        <a class="link" href="api-cockpit.html#cockpit-locale-gettext" title="cockpit.gettext()"><code class="code">cockpit.gettext()</code></a> make use
        of the loaded data.</p>
</div>
<div class="refsection">
<a name="cockpit-locale-gettext"></a><h3>cockpit.gettext()</h3>
<pre class="programlisting">
 translated = cockpit.gettext([context], string)
 var _ = cockpit.gettext
 var C_ = cockpit.gettext
 translated = _("string")
 translated = C_("context", "string")
</pre>
<p>Lookup <code class="code">string</code> for translation in the loaded locale data. The translated string will
        be returned, or <code class="code">string</code> will be returned if no such translated string is
        present. The <code class="code">context</code> argument is an optional string used to qualify the
        string.</p>
<p>This function can be assigned to a variable called <code class="code">_</code> (underscore) which
        will make your code work with the typical <code class="code">_("string")</code> syntax.</p>
</div>
<div class="refsection">
<a name="cockpit-locale-noop"></a><h3>cockpit.noop()</h3>
<pre class="programlisting">
  var N_ = cockpit.noop
  var NC_ = cockpit.noop
</pre>
<p>A noop function suitable for assigning to <code class="code">N_</code> or <code class="code">NC_</code> so that
        gettext scanners will be able to find translatable strings. More specifically this function
        returns its last argument.</p>
</div>
<div class="refsection">
<a name="cockpit-locale-ngettext"></a><h3>cockpit.ngettext()</h3>
<pre class="programlisting">
 translated = cockpit.ngettext([context], string1, stringN, number)
</pre>
<p>Lookup a string appropriate for a pluralization form of the <code class="code">number</code>.
        Various languages have complex pluralization forms that go far between the singular
        and plural forms speakers of English are familiar with. If no such translated
        string is found then either one of <code class="code">string1</code> or <code class="code">stringN</code> is
        returned according to simple pluralization rules.</p>
<p>The <code class="code">context</code> argument is an optional string used to qualify the string.</p>
</div>
<div class="refsection">
<a name="cockpit-locale-translate"></a><h3>cockpit.translate()</h3>
<pre class="programlisting">
 cockpit.translate([sel])
</pre>
<p>The document will be scanned for translatable tags and they will be translated according
        to the strings in loaded locale data. If <code class="code">sel</code> is specified, this should be a jQuery
        selector for the specific part of the document to translate.</p>
</div>
</div>
<div class="refsection">
<a name="idm139751634385600"></a><h2>File Access</h2>
<p>Reading, writing, and watching files.</p>
<pre class="programlisting">
file = cockpit.file(path,
                    { syntax: syntax_object,
                      binary: boolean
                    })

promise = file.read()
promise
    .done(function (content, tag) { ... })
    .fail(function (error) { ... })

promise = file.replace(content, [ expected_tag ])
promise
    .done(function (new_tag) { ... })
    .fail(function (error) { ... })

promise = file.modify(callback, [ initial_content, initial_tag ]
promise
    .done(function (new_content, new_tag) { ... })
    .fail(function (error) { ... })

file.watch(function (content, tag, [error]) { })

file.close()
</pre>
<div class="refsection">
<a name="idm139751634386976"></a><h3>Simple reading and writing</h3>
<p>You can read a file with code like this:</p>
<pre class="programlisting">
cockpit.file("/path/to/file").read().
    done(function (content, tag) {
        ...
    }).
    fail(function (error) {
        ...
    });
</pre>
<p>The <code class="code">read()</code> method returns a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>.</p>
<p>When successful, the promise will be resolved with the content of the
        file. Unless you specify options to change this (see below), the file
        is assumed to be text in the UTF-8 encoding, and <code class="code">content</code>
        will be a string.</p>
<p>The tag that is passed to the <code class="code">done()</code> callback is a short
        string that is associated with the file and changes whenever the
        content of the file changes.  It is meant to be used with <code class="code">replace()</code>.</p>
<p>It is not an error when the file does not exist. In this case, the
        <code class="code">done()</code> callback will be called with a <code class="code">null</code>
        value for <code class="code">content</code> and <code class="code">tag</code> is <code class="code">"-"</code>.</p>
<p>To write to a file, use code like this:
</p>
<pre class="programlisting">
cockpit.file("/path/to/file").replace("my new content\n").
    done(function (tag) {
        ...
    }).
    fail(function (error) {
        ...
    });
</pre>
<p>
      </p>
<p>The <code class="code">replace()</code> method returns a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>.</p>
<p>When the promise is resolved, the file has been atomically replaced
        (via the <code class="code">rename()</code> syscall) with the new content. As with
        <code class="code">read()</code>, by default the new content is a string and will
        be written to the file as UTF-8. The returned tag corresponds to the
        new content of the file.</p>
<p>When the promise is rejected because of an error, the file or its meta
        data has not been changed in any way.</p>
<p>As a special case, passing the value <code class="code">null</code> to
        <code class="code">replace()</code> will remove the file.</p>
<p>The <code class="code">replace()</code> method can also check for conflicting
        changes to a file.  You can pass a tag (as returned by
        <code class="code">read()</code> or <code class="code">replace()</code>) to
        <code class="code">replace()</code>, and the file will only be replaced if it still
        has the given tag.  If the tag of the file has changed,
        <code class="code">replace()</code> will fail with an error object that has
        <code class="code">error.problem == "change-conflict"</code>. See
        <code class="code">modify()</code> below for a convenient way to achieve
        transactional updates to a file.</p>
</div>
<div class="refsection">
<a name="idm139751634404320"></a><h3>File format</h3>
<p>By default, a file is assumed to be text encoded in UTF-8, and the
        <code class="code">read()</code> and <code class="code">replace()</code> functions use strings to
        represent the content.</p>
<p>By specifying the <code class="code">syntax.parser()</code> and
        <code class="code">syntax.stringify()</code> options, you can cause
        <code class="code">read()</code> to parse the content before passing it back to
        you, and <code class="code">replace()</code> to unparse it before writing.</p>
<p>The main idea is to be able to write <code class="code">{ syntax: JSON }</code>, of
        course, but you can easily pass in individual functions or make your
        own parser/unparser object:
</p>
<pre class="programlisting">
cockpit.file("/path/to/file.json", { syntax: JSON })

var syntax_object = { parse:     my_parser,
                      stringify: my_unparser
                    };

cockpit.file("/path/to/file", { syntax: syntax_object })
</pre>
<p>
        Any exceptions thrown by the <code class="code">parse()</code> and
        <code class="code">stringify()</code> functions are caught and reported as read or
        write errors.</p>
<p>The <code class="code">null</code> value that is used to represent the content of a
        non-existing file (see "Simple reading and writing", above) is not
        passed through the <code class="code">parse()</code> and <code class="code">stringify()</code>
        functions.</p>
</div>
<div class="refsection">
<a name="idm139751634412784"></a><h3>Binary files</h3>
<p>By default the content of the file is assumed to be text encoded as
        UTF-8 and it can not contain zero bytes.  The content is represented
        as a JavaScript string with <code class="code">read()</code>,
        <code class="code">replace()</code>, etc. By setting the <code class="code">binary</code> option
        to true when creating the proxy, no assumptions are placed on the
        content, and it is represented as a <code class="code">Uint8Array</code> in
        JavaScript.</p>
</div>
<div class="refsection">
<a name="idm139751634415728"></a><h3>Atomic modifications</h3>
<p>Use <code class="code">modify()</code> to modify the content of the file safely.  A
        call to <code class="code">modify()</code> will read the content of the file, call
        <code class="code">callback</code> on the content, and then replace the content of
        the file with the return value of the callback.</p>
<p>The <code class="code">modify()</code> method uses the <code class="code">read()</code> and
        <code class="code">replace()</code> methods internally in the obvious way. Thus,
        the <code class="code">syntax.parse()</code> and <code class="code">syntax.stringify()</code>
        options work as expected, <code class="code">null</code> represents a non-existing
        file, and the watch callbacks are fired.</p>
<p>It will do this one or more times, until no other conflicting changes
        have been made to the file between reading and replacing it.</p>
<p>The callback is called like this
</p>
<pre class="programlisting">
    new_content = callback (old_content)
</pre>
<p>
        The callback is allowed to mutate <code class="code">old_content</code>, but note
        that this will also mutate the objects that are passed to the watch
        callbacks. Returning <code class="code">undefined</code> from the proxy is the
        same as returning <code class="code">old_content</code>.</p>
<p>The <code class="code">modify()</code> method returns a
        <a class="ulink" href="http://api.jquery.com/category/deferred-object/" target="_top">jQuery promise</a>.</p>
<p>The promise will be resolved with the new content and its tag, like so
</p>
<pre class="programlisting">
function shout(old_content) {
   return old_content.toUpperCase();
}

cockpit.file("/path/to/file").modify(shout).
    done(function (content, tag) {
        ...
    }).
    fail(function (error) {
        ...
    });
</pre>
<p>
        If you have cached the last content and tag results of the
        <code class="code">read()</code> or <code class="code">modify()</code> method, or the last
        values passed to a watch callback, you can pass them to
        <code class="code">modify()</code> as the second and third argument.  In this case,
        <code class="code">modify()</code> will skip the initial read and start with the
        given values.</p>
</div>
<div class="refsection">
<a name="idm139751634428848"></a><h3>Change notifications</h3>
<p>Calling <code class="code">watch()</code> will start monitoring the file for
        external changes.
</p>
<pre class="programlisting">
handle = file.watch(callback);
</pre>
<p>
        Whenever a change occurs, the <code class="code">callback()</code> is called with
        the new content and tag of the file.  This might happen because of
        external changes, but also as part of calls to <code class="code">read()</code>,
        <code class="code">replace()</code>, and <code class="code">modify()</code>.</p>
<p>When a read error occurs, the <code class="code">callback()</code> is called with
        an error as a third argument. Write errors are not reported via the watch callback.</p>
<p>Calling <code class="code">watch()</code> will also automatically call
        <code class="code">read()</code> to get the initial content of the file.</p>
<p>Thus, you normally don't need to call <code class="code">read()</code> at all when
        using <code class="code">watch()</code>.</p>
<p>To free the resources used for monitoring, call <code class="code">handle.remove()</code>.</p>
</div>
<div class="refsection">
<a name="idm139751634438096"></a><h3>Closing</h3>
<p>Call the <code class="code">close()</code> method on a file proxy to cancel all
        ongoing operations, such as reading, writing, and monitoring. The
        proxy should not be used after closing it.</p>
</div>
</div>
<div class="refsection">
<a name="idm139751634439360"></a><h2>Metrics</h2>
<p>Metrics about the system can be retrieved from several sources using
      <a class="link" href="api-cockpit.html#cockpit-metrics" title="cockpit.metrics()"><code class="code">cockpit.metrics()</code></a> metrics channels.
      The metrics are made available as series data, and can be used with the
      <a class="link" href="api-cockpit.html#cockpit-series" title="cockpit.series()"><code class="code">cockpit.series()</code></a> and 
      <a class="link" href="api-cockpit.html#cockpit-grid" title="cockpit.grid()"><code class="code">cockpit.grid()</code></a> facilities.</p>
<div class="refsection">
<a name="cockpit-metrics"></a><h3>cockpit.metrics()</h3>
<pre class="programlisting">
  metrics = cockpit.metrics(interval, options)
</pre>
<p>Opens a new metrics channel. The data retrieved will be available in the
        <a class="link" href="api-cockpit.html#cockpit-metrics-series" title="metrics.series"><code class="code">metrics.series</code></a> series sink, and can
        be used together with <a class="link" href="api-cockpit.html#cockpit-grid" title="cockpit.grid()"><code class="code">cockpit.grid()</code></a> objects.</p>
<p>The <code class="code">interval</code> is in milliseconds, and is the granularity of the series data
        retrieved. Any grids consuming the data must have the same interval.</p>
<p>The options argument is a javascript plain object with the following fields.
        The <code class="code">"source"</code> and <code class="code">"metrics"</code> options are required.</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">"cache"</code></span></p></td>
<td><p>A cache identifier. If set, then this metrics channel will share data
            with other metrics channels of the same identifier. Make sure to use a globally
            unique string.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"metrics"</code></span></p></td>
<td><p>An array of metrics names to retrieve. Or an array of full metric
            descriptions, as javascript objects. The specifics of these, and how to determine
            which ones to use, are unfortunately not yet documented.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"source"</code></span></p></td>
<td><p>Set to <code class="code">"internal"</code> to retrieve internal metrics read
            by the bridge. If set to <code class="code">"direct"</code> or <code class="code">"pmcd"</code> then data
            will be retrieved from <a class="ulink" href="http://pcp.io" target="_top">PCP</a>if it is
            available.</p></td>
</tr>
</tbody>
</table></div>
</div>
<div class="refsection">
<a name="cockpit-metrics-fetch"></a><h3>metrics.fetch()</h3>
<pre class="programlisting">
  metrics.fetch(beg, end)
</pre>
<p>Retrieve archived metrics data between <code class="code">beg</code> and <code class="code">end</code>. The
        arguments can either be numbers, in which case they are interval based offsets, or they
        can be javascript Date objects.</p>
</div>
<div class="refsection">
<a name="cockpit-metrics-follow"></a><h3>metrics.follow()</h3>
<pre class="programlisting">
  metrics.follow()
</pre>
<p>Start retrieving live metrics data as it become available.</p>
</div>
<div class="refsection">
<a name="cockpit-metrics-close"></a><h3>metrics.close()</h3>
<pre class="programlisting">
  metrics.close()
</pre>
<p>Stop the retrieval of metrics and release resources.</p>
</div>
<div class="refsection">
<a name="cockpit-metrics-series"></a><h3>metrics.series</h3>
<p>The series sink where data retrieved data will be processed.</p>
</div>
</div>
<div class="refsection">
<a name="idm139751634466032"></a><h2>Series Data</h2>
<p>Series data consists of values along a continuous (usually time) axis. We
      can place these in grids which expose a distinct subset of these values. These are
      the underlying mechanism for displaying metrics data in graphs.</p>
<div class="refsection">
<a name="cockpit-grid"></a><h3>cockpit.grid()</h3>
<pre class="programlisting">
  grid = cockpit.grid(interval, [beg, end])
</pre>
<p>Creates a grid object to contain series data.</p>
<p>The <code class="code">interval</code> is the granularity of the grid. Usually this is
        a number of milliseconds, when used with time series data. The <code class="code">beg</code>
        and <code class="code">end</code> are the bounds of the grid. If omitted they will be set to
        zero for an initially empty grid.</p>
<p>If <code class="code">beg</code> and/or <code class="code">end</code> are negative (including negative
        zero) then they are interpreted in number of intervals relative to the current
        time. Thus cockpit.grid(1000, -300, -0) will create a grid for the most recent
        5 minutes.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-add"></a><h3>grid.add()</h3>
<pre class="programlisting">
  row = grid.add(series, path)
  row = grid.add(callback, [early])
  row = grid.add()
</pre>
<p>Adds a row to the grid. The returned <code class="code">row</code> is a Javascript array that will contain
        series data. The arguments control how the row is populated from the series data.
        The <code class="code">row</code> is a sparse array. Its <code class="code">row.length</code> will not match the
        expected size of the grid, unless and until the row has been completely filled in. The first
        index of the <code class="code">row</code> will contain the data from the series data at the
        <a class="link" href="api-cockpit.html#cockpit-grid-beg" title="grid.beg"><code class="code">grid.beg</code></a> offset.</p>
<p>When no arguments are passed, an empty row is added, and it is not populated with data.</p>
<p>When called with a <code class="code">series</code> and <code class="code">path</code> argument then the row
        will be populated directly with series data. The <code class="code">series</code> can either be a
        <a class="link" href="api-cockpit.html#cockpit-series" title="cockpit.series()">series object</a> or an object that has an <code class="code">obj.series</code>
        property. The <a class="link" href="api-cockpit.html#cockpit-series-interval" title="series.interval">series interval</a> must match the
        interval of this grid.
        If <code class="code">path</code> is missing or empty, then the series data is placed into the row
        directly. Otherwise <code class="code">path</code> indicates which part of the series data to place in the
        row. When <code class="code">path</code> is an array, it is used as a set of property names or array indexes
        to follow into nested series data. When <code class="code">path</code> is a dotted string, it is split and used
        the same way to locate the correct value in nested series data. The exact format of the series
        data depends on its producer, and relevant paths will be documented there.</p>
<p>If a <code class="code">callback</code> function is specified, then it will be invoked to provide series data
        for the row. The function is invoked as <code class="code">callback(row, index, count)</code>, where the
        <code class="code">row</code> is the row to fill in, the <code class="code">index</code> is the index to start filling in and
        <code class="code">count</code> is the number of items to fill in. The <code class="code">this</code> variable will be set
        to the grid while invoking the <code class="code">callback</code>. The callback is called after other data
        rows for a given series have been filled in. Callbacks are called in the order added, unless the
        <code class="code">early</code> argument is set to <code class="code">true</code>, in which case the callback is called earlier
        than callbacks without the <code class="code">early</code> argument set.</p>
<p>To remove the row use the
        <a class="link" href="api-cockpit.html#cockpit-grid-remove" title="grid.remove()"><code class="code">grid.remove()</code> method.</a>
      </p>
<p>The row will start being populated with data when the <code class="code">series</code> produces data.
        To make this happen right away, use the
        <a class="link" href="api-cockpit.html#cockpit-grid-sync" title="grid.sync()"><code class="code">grid.sync()</code></a> method.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-remove"></a><h3>grid.remove()</h3>
<pre class="programlisting">
  grid.remove(row)
</pre>
<p>Remove a previously added <code class="code">row</code> from the grid. The row will no longer be updated
        with series data.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-sync"></a><h3>grid.sync()</h3>
<pre class="programlisting">
  grid.sync()
</pre>
<p>Load or reload data from the series into the rows. This does not clear the rows before
        populating them. Some data may be populated immediately, others may have to wait until data
        can be loaded. Internally this function calls
        <a class="link" href="api-cockpit.html#cockpit-series-load" title="series.load()"><code class="code">series.load()</code></a> for each series.</p>
<p>All rows with callbacks will be invoked to regenerate all the data. The
        <a class="link" href="api-cockpit.html#cockpit-grid-onnotify" title="grid.onnotify"><code class="code">grid.onnotify</code></a> event will be triggered.
        It is not necessary to call this function after a call of the
        <a class="link" href="api-cockpit.html#cockpit-grid-move" title="grid.move()"><code class="code">grid.move()</code></a> method.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-move"></a><h3>grid.move()</h3>
<pre class="programlisting">
  grid.move(beg[, end])
</pre>
<p>Move the grid to new <code class="code">beg</code> and <code class="code">end</code> range. Data will be
        discarded from the rows and <a class="link" href="api-cockpit.html#cockpit-grid-sync" title="grid.sync()"><code class="code">grid.sync()</code></a>
        will be called to load or reload series data for the new range of offsets.</p>
<p>If <code class="code">end</code> is not specified it will be set to <code class="code">beg</code>. If <code class="code">beg</code>
        and/or <code class="code">end</code> are negative (including negative zero) then they will be set to the
        number of intervals prior to the current time taken as an interval.</p>
<p>If <code class="code">beg</code> and/or <code class="code">end</code> are negative (including negative
        zero) then they are interpreted in number of intervals relative to the current
        time. Thus cockpit.grid(1000, -300, -0) will create a grid for the most recent
        5 minutes.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-walk"></a><h3>grid.walk()</h3>
<pre class="programlisting">
  grid.walk()
</pre>
<p>Move the grid forward every
        <a class="link" href="api-cockpit.html#cockpit-grid-interval" title="grid.interval"><code class="code">grid.interval</code></a> milliseconds. To stop
        moving forward, call <a class="link" href="api-cockpit.html#cockpit-grid-move" title="grid.move()"><code class="code">grid.move()</code></a>.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-notify"></a><h3>grid.notify()</h3>
<pre class="programlisting">
  grid.notify(index, count)
</pre>
<p>This function is called to have rows with callbacks recalculate their data. It is not
        normally necessary to call this function, as it will be invoked automatically when new
        series data is available or has been loaded. This function triggers the
        <a class="link" href="api-cockpit.html#cockpit-grid-onnotify" title="grid.onnotify"><code class="code">grid.onnotify</code></a> event.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-onnotify"></a><h3>grid.onnotify</h3>
<pre class="programlisting">
  $(grid).on("notify", function(index, count) { ... });
</pre>
<p>An event that is triggered when some part of the series data in grid changes. The
        <code class="code">index</code> is the row index where things changed, and the <code class="code">count</code>
        is the length of the data that changed.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-close"></a><h3>grid.close()</h3>
<pre class="programlisting">
  grid.close()
</pre>
<p>Close the grid, and stop updating the rows.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-interval"></a><h3>grid.interval</h3>
<p>The granularity of the grid. For time series data this is an interval in
        milliseconds. In order to use a given
        <a class="link" href="api-cockpit.html#cockpit-grid" title="cockpit.grid()">grid</a> and
        <a class="link" href="api-cockpit.html#cockpit-series" title="cockpit.series()">series</a> together, their interval properties
        must match.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-beg"></a><h3>grid.beg</h3>
<p>The beginning offset of the series data in the grid. Do not set this property
        directly. Use the <a class="link" href="api-cockpit.html#cockpit-grid-move" title="grid.move()">grid.move()</a> method instead.</p>
</div>
<div class="refsection">
<a name="cockpit-grid-end"></a><h3>grid.end</h3>
<p>The ending offset of the series data in the grid. Do not set this property
        directly. Use the <a class="link" href="api-cockpit.html#cockpit-grid-move" title="grid.move()">grid.move()</a> method instead.</p>
</div>
<div class="refsection">
<a name="cockpit-series"></a><h3>cockpit.series()</h3>
<pre class="programlisting">
  series = cockpit.series(interval, [cache, fetch])
</pre>
<p>Create a new sink of series data. This is usually done by producers of series data,
        and it is rare to invoke this function directly.</p>
<p>The <code class="code">interval</code> is the granularity of the series data. For time series data
        this is an interval in milliseconds. If a <code class="code">cache</code> string is specified, series data
        will be cached across frames for series with the same <code class="code">cache</code> cache identifier
        to load and/or reload.</p>
<p>If a <code class="code">fetch</code> callback
        is specified, then it will be invoked when grids request certain ranges of data. The
        <code class="code">fetch</code> callback is invoked with <code class="code">function fetch(beg, end) { ... }</code>
        range offsets. The <a class="link" href="api-cockpit.html#cockpit-series-input" title="series.input()">series.input()</a> should be
        called with data retrieved, either immediately or at a later time. The callback may be
        called multiple times for the same ranges of data. It is up to the callback to determine
        when or whether it should retrieve the data more than once.</p>
<p>A producer of series data, usually calls this function and creates itself a
        <code class="code">obj.series</code> property containing this series object.</p>
</div>
<div class="refsection">
<a name="cockpit-series-input"></a><h3>series.input()</h3>
<pre class="programlisting">
  series.input(beg, items[, mapping])
</pre>
<p>Send series data into the series sink. Any grids that have added rows based on this
        series, will have data filled in. The <code class="code">beg</code> is the beginning offset of
        <code class="code">items</code>. The <code class="code">items</code> are an array one or more series data items.</p>
<p>Producers may wish to provide additional properties that can be used in lookup paths that
        rows can pull from. This is done in the <code class="code">mapping</code> argument. If specified it is
        a tree of objects. Each sub object should have a property with the name <code class="code">""</code>
        empty string, which will be used as the property name or index in place of the one used
        in the lookup path.</p>
</div>
<div class="refsection">
<a name="cockpit-series-load"></a><h3>series.load()</h3>
<pre class="programlisting">
  series.load(beg, end)
</pre>
<p>Load data from the series into any grids that have rows based on this series data.
        Any cached data will be filled in immediately. Any data not cached, will be requested
        from the producer, if possible, and may arrive at a later time.</p>
<p>The <code class="code">beg</code> and <code class="code">end</code> denote the range of data to load.</p>
</div>
<div class="refsection">
<a name="cockpit-series-interval"></a><h3>series.interval</h3>
<p>The granularity of the series. For time series data this is an interval in
        milliseconds. In order to use a given
        <a class="link" href="api-cockpit.html#cockpit-grid" title="cockpit.grid()">grid</a> and
        <a class="link" href="api-cockpit.html#cockpit-series" title="cockpit.series()">series</a> together, their interval properties
        must match.</p>
</div>
<div class="refsection">
<a name="cockpit-series-limit"></a><h3>series.limit</h3>
<p>The maximum number of items to cache for loading and/or reloading. You can
        change this value to a different number. Having a number close to zero will break
        certain usage of grids, such as
        <a class="link" href="api-cockpit.html#cockpit-grid-walk" title="grid.walk()"><code class="code">grid.walk()</code></a>.</p>
</div>
</div>
<div class="refsection">
<a name="idm139751634539968"></a><h2>Utilities</h2>
<p>Various utility functions.</p>
<div class="refsection">
<a name="cockpit-format"></a><h3>cockpit.format()</h3>
<pre class="programlisting">
 string = cockpit.format(template, args)
 string = cockpit.format(template, [arg, ...])
</pre>
<p>Format a string interpolating <code class="code">args</code> into <code class="code">template</code> using
        shell like syntax. The <code class="code">args</code> may be either an array or javascript object.
        The <code class="code">template</code> can contain fields that look like <code class="code">$name</code> or
        <code class="code">${name}</code> or <code class="code">$0</code>. Numeric fields are used with array
        <code class="code">args</code> and start at zero.</p>
<p>In the second form, multiple <code class="code">arg</code> arguments may be passed directly,
        and interpolated as as numeric fields in the <code class="code">template</code>.</p>
</div>
<div class="refsection">
<a name="cockpit-format-bytes"></a><h3>cockpit.format_bytes()</h3>
<pre class="programlisting">
 string = cockpit.format_bytes(number, [factor])
 array = cockpit.format_bytes(number, [factor, separate])
</pre>
<p>Formats <code class="code">number</code> into a displayable <code class="code">string</code> with a suffix, such as
        <span class="emphasis"><em>KB</em></span> or <span class="emphasis"><em>MB</em></span>. Returns an <code class="code">array</code> of the
        formatted number and the suffix if <code class="code">separate</code> is set to <code class="code">true</code>.</p>
<p>If specifying 1000 or 1024 is specified as a <code class="code">factor</code> then an appropriate suffix
        will be chosen. By default the <code class="code">factor</code> is 1024.  You can pass a string suffix as a
        <code class="code">factor</code> in which case the resulting number will be formatted with the same suffix.</p>
<p>If the <code class="code">number</code> is less than the <code class="code">factor</code> or an unknown factor
        was passed in, then the formatted number is returned without a suffix. If <code class="code">separate</code>
        is true, returns an array of <code class="code">[formatted_number, suffix]</code> unless no suffix is returned.</p>
</div>
<div class="refsection">
<a name="idm139751636201888"></a><h3>cockpit.format_bytes_per_sec()</h3>
<pre class="programlisting">
   string = cockpit.format_bytes_per_sec(number)
  </pre>
<p>Format <code class="code">number</code> of bytes into a displayable speed <code class="code">string</code>.</p>
</div>
<div class="refsection">
<a name="idm139751636204544"></a><h3>cockpit.format_bits_per_sec()</h3>
<pre class="programlisting">
    string = cockpit.format_bits_per_sec(number)
  </pre>
<p>Format <code class="code">number</code> of bits into a displayable speed <code class="code">string</code>.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-packages"></a><h2>Manifest Info</h2>
<p>You can load manifest info by loading the <code class="code">./manifest.json</code> file in
      your package. In addition there is a shortcut: if you're using AMD loading you can
      use a special module id to access all the manifests in one shot:</p>
<pre class="programlisting">
  define([
      'manifests',
      'other.dep'
  ], function(manifests, other) {
    var manifest = manifests['package'];
  });
</pre>
</div>
<div class="refsection">
<a name="cockpit-cache"></a><h2>Object Cache</h2>
<p>If the same information is displayed by multiple components in Cockpit,
      <code class="code">cockpit.cache()</code> provides a way to share data between them. The shared
      data should be simple objects, arrays, and values, and not contain functions or
      other objects.</p>
<div class="refsection">
<a name="idm139751638988896"></a><h3>cockpit.cache()</h3>
<pre class="programlisting">
  cache = cockpit.cache(key, provider, consumer)
</pre>
<p>Create a new cache object. The <code class="code">key</code> should be a globally unique string
        that describes the data being cached. This string must describe the data, across all
        machines and all versions of cockpit. It is customary to include a version number in
        the <code class="code">key</code> string.</p>
<pre class="programlisting">
  function provider(result, key) {
      result("myvalue");

      return {
          close: function() {
              /* closed */
          }
      };
  }
</pre>
<p>The <code class="code">provider</code> is a function that will be invoked to start retrieving
        data for the cache. It will be passed a <code class="code">result</code> function as its first
        argument. The <code class="code">result</code> should be invoked whenever new data is available.
        The <code class="code">key</code> argument matches the key string the cache was created with.</p>
<p>The <code class="code">provider</code> can return an object with a <code class="code">close</code> method.
        This method will be invoked when the cache no longer needs data from the provider.</p>
<pre class="programlisting">
  function consumer(value, key) {
      /* ... */
  }
</pre>
<p>The <code class="code">consumer</code> is a function that will be passed new values when they
        are available, whether they come from the <code class="code">provider</code> or a source in a
        different component/frame.</p>
</div>
<div class="refsection">
<a name="idm139751643072592"></a><h3>cache.close()</h3>
<pre class="programlisting">
  cache.close()
</pre>
<p>Close a cache and stop calling its <code class="code">consumer</code>. If the <code class="code">provider</code>
        was invoked, then the <code class="code">close()</code> method it returned will be invoked.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-channels"></a><h2>Raw Channels</h2>
<p>At a low level Cockpit communicates with the system via messages passed
      through various channels. These are usually exposed via higher level APIs,
      such as the <code class="code"><a class="link" href="api-cockpit.html#cockpit-spawn" title="Spawning Processes">cockpit.spawn()</a></code> function.
      It is rare to use raw channels directly.</p>
<div class="refsection">
<a name="cockpit-channels-channel"></a><h3>cockpit.channel()</h3>
<pre class="programlisting">
 channel = cockpit.channel(options)
</pre>
<p>This function creates a new channel for communication with the system.
        It returns a new channel object. The <code class="code">options</code> argument is a
        plain object. At least the <code class="code">"payload"</code> option is required, and
        based on the payload type, other options may be required.</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">"binary"</code></span></p></td>
<td><p>Set to <code class="code">true</code> to transfer binary payloads. Both messages
            sent via <a class="link" href="api-cockpit.html#cockpit-channels-send" title="channel.send()"><code class="code">channel.send()</code></a>
            and those received via
            <a class="link" href="api-cockpit.html#cockpit-channels-message" title="channel.onmessage"><code class="code">channel.onmessage</code></a>
            should be arrays of bytes, either <code class="code">Uint8Array</code> or <code class="code">Array</code>
            depending on browser support.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"host"</code></span></p></td>
<td><p>The host to open the channel to. If no host is specified
            then the correct one will be automatically selected based on the page
            calling this function.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"payload"</code></span></p></td>
<td><p>The payload type for the channel. Only specific payload
            types are supported.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"superuser"</code></span></p></td>
<td>
<p>Set to <code class="code">"require"</code> to open this channel as root. If the currently
            logged in user is not permitted to become root (eg: via <code class="code">pkexec</code>) then the
            <code class="code">channel</code> will immediately be
            <a class="link" href="api-cockpit.html#cockpit-channels-close-ev" title="channel.onclose">closed</a> with a <code class="code">"access-denied"</code>
            problem code.</p>
<p>Set to <code class="code">"try"</code> to try to open the channel as root, but if that fails,
            then fall back to an unprivileged channel.</p>
</td>
</tr>
</tbody>
</table></div>
<p>The channel object returned has the following fields and methods and
        events. You should call the
        <code class="code"><a class="link" href="api-cockpit.html#cockpit-channels-close" title="channel.close()">channel.close()</a></code>
        method when done with the channel.</p>
<p>A valid channel will always be returned and the is ready to
        <code class="code"><a class="link" href="api-cockpit.html#cockpit-channels-send" title="channel.send()">channel.send()</a></code>. The channel may
        <a class="link" href="api-cockpit.html#cockpit-channels-close-ev" title="channel.onclose">close shortly afterword</a> due
        to a failure.</p>
</div>
<div class="refsection">
<a name="cockpit-channels-binary"></a><h3>channel.binary</h3>
<p>Will be <code class="code">true</code> for an binary channel. Will be set to <code class="code">false</code> if the
        channel is textual.</p>
</div>
<div class="refsection">
<a name="cockpit-channels-options"></a><h3>channel.options</h3>
<p>The options used to open this channel. This should not be changed.</p>
</div>
<div class="refsection">
<a name="cockpit-channels-valid"></a><h3>channel.valid</h3>
<p>Will be <code class="code">true</code> for an open channel. Will be set to <code class="code">false</code> if the channel
        closes.</p>
</div>
<div class="refsection">
<a name="cockpit-channels-send"></a><h3>channel.send()</h3>
<pre class="programlisting">
 channel.send(data)
</pre>
<p>Send a message over the channel. The contents of the message depends on the
        payload type of the channel. If a binary channel, then <code class="code">data</code> is expected
        to be an <code class="code">Array</code> of bytes or a <code class="code">Uint8Array</code>. If not binary,
        then the <code class="code">data</code> will be converted to a string if not already a string.</p>
</div>
<div class="refsection">
<a name="cockpit-channels-control"></a><h3>channel.control()</h3>
<pre class="programlisting">
 channel.control(options)
</pre>
<p>Notify the channel to tune certain parameters on the fly. The <code class="code">options</code>
        is a plain javascript object, and the contents depend on the <code class="code">"payload"</code>
        of the channel.</p>
<p>One common operation is to set <code class="code">"command"</code> to <code class="code">"done"</code> in the
        options field. To indicate that no further messages will be sent through the channel.</p>
</div>
<div class="refsection">
<a name="cockpit-channels-close"></a><h3>channel.close()</h3>
<pre class="programlisting">
 channel.close([options])
</pre>
<p>Close the channel.</p>
<p>If <code class="code">options</code> is present it can be a plain javascript object
        containing additional channel close options to send to the peer. If closing for
        because of a problem, set the <code class="code">"problem"</code> field to a
        <a class="link" href="api-cockpit.html#cockpit-problems" title="Problem Codes">problem code</a>. If <code class="code">options</code>
        is not an object it will be treated as a <code class="code">"problem"</code>.</p>
<p>The <a class="link" href="api-cockpit.html#cockpit-channels-close-ev" title="channel.onclose">close event</a> will fire.
        A channel can also be closed by a peer or if the underlying transport closes.</p>
</div>
<div class="refsection">
<a name="cockpit-channels-message"></a><h3>channel.onmessage</h3>
<pre class="programlisting">
 $(channel).on("message", function(event, data) { ... })
 channel.addEventListener("message", function(event, data) { ... })
</pre>
<p>An event triggered when the channel receives a message. The message is
        passed as a string to the handler in the <code class="code">data</code>. In the case of binary
        channels <code class="code">data</code> is an <code class="code">Uint8Array</code> or an <code class="code">Array</code>
        of bytes if the former is not supported by the browser. The contents of
        the message depends on the payload type of the channel.</p>
</div>
<div class="refsection">
<a name="cockpit-channels-oncontrol"></a><h3>channel.oncontrol</h3>
<pre class="programlisting">
 $(channel).on("control", function(event, options) { ... })
 channel.addEventListener("control", function(event, options) { ... })
</pre>
<p>An event triggered when the channel receives an control message in the
        middle of the flow. One particular use is when the <code class="code">command</code> is set to
        <code class="code">"done"</code> then no further messages will be received in the channel.
        The exact form of these messages depend on the <code class="code">"payload"</code> of the
        channel.</p>
</div>
<div class="refsection">
<a name="cockpit-channels-close-ev"></a><h3>channel.onclose</h3>
<pre class="programlisting">
 $(channel).on("close", function(options) { ... })
 channel.addEventListener("close", function(event, options) { ... })
</pre>
<p>An event triggered when the channel closes. This can happen either because
        <a class="link" href="api-cockpit.html#cockpit-channels-close" title="channel.close()">channel.close()</a> function was called,
        or if the peer closed the channel, or the underlying transport closes.</p>
<p>The <code class="code">options</code> will contain various close information, including a
        <code class="code">"problem"</code> field which will be set if the channel was closed because
        of a problem.</p>
</div>
<div class="refsection">
<a name="cockpit-transport-origin"></a><h3>cockpit.transport.origin</h3>
<pre class="programlisting">
  cockpit.transport.origin
</pre>
<p>The HTTP origin that is being used by the underlying channel transport. This is
        read-only, you should not assign a value. If the browser supports
        <code class="code">window.location.origin</code> then this will be identical to that value.</p>
</div>
<div class="refsection">
<a name="cockpit-transport-host"></a><h3>cockpit.transport.host</h3>
<pre class="programlisting">
  cockpit.transport.host
</pre>
<p>The host that this transport is going to talk to by default. This is
        read-only, you should not assign a value. If the value is null that means that the
        transport has not been setup yet.</p>
</div>
<div class="refsection">
<a name="cockpit-transport-options"></a><h3>cockpit.transport.options</h3>
<pre class="programlisting">
  cockpit.transport.options
</pre>
<p>Initialization options received over the underlying channel transport. These
        will be empty until connection is properly established.</p>
</div>
<div class="refsection">
<a name="cockpit-transport-close"></a><h3>cockpit.transport.close()</h3>
<pre class="programlisting">
  cockpit.transport.close([problem])
</pre>
<p>Close the underlying channel transport. All channels open channels will close.
        The <code class="code">problem</code> argument should be a problem code string. If not specified
        it will default to <code class="code">"disconnected"</code>.</p>
</div>
<div class="refsection">
<a name="cockpit-transport-filter"></a><h3>cockpit.transport.filter()</h3>
<pre class="programlisting">
  cockpit.transport.filter(function(message, channel, control) { ... })
</pre>
<p>Add a filter to the underlying channel transport. All incoming messages will be
        passed to each of the filter callbacks that are registered.</p>
<p>This function is rarely used.</p>
<p>Filter callbacks are called in the order they are registered. If a filter
        callback returns <code class="code">false</code> then the message will not be dispatched
        further, whether to other filters, or to channels, etc.</p>
<p>The <code class="code">message</code> is the string or array with the raw message including,
	the framing. If <code class="code">channel</code> is set to a string this is a payload
	message in the specified channel. If <code class="code">control</code> is set then this is
	a control message, and the <code class="code">control</code> argument contains the parsed
	JSON object of the control message.</p>
</div>
<div class="refsection">
<a name="cockpit-transport-inject"></a><h3>cockpit.transport.inject()</h3>
<pre class="programlisting">
  cockpit.transport.inject(message)
</pre>
<p>Inject a message into the underlying channel transport. The <code class="code">message</code>
        should be a <code class="code">string</code> or an array of bytes, and should be valid
        according to the Cockpit message protocol.</p>
<p>This function is rarely used. In general you should only <code class="code">inject()</code>
        messages you got from a <code class="code"><a class="link" href="api-cockpit.html#cockpit-transport-filter" title="cockpit.transport.filter()">filter()</a></code>.</p>
</div>
<div class="refsection">
<a name="cockpit-base64-encode"></a><h3>cockpit.base64_encode()</h3>
<pre class="programlisting">
  string = cockpit.base64_encode(data)
</pre>
<p>Encode binary data into a string using the Base64 encoding. The <code class="code">data</code>
        argument can either be a <code class="code">string</code>, an <code class="code">Array</code>, an <code class="code">ArrayBuffer</code>
        or a <code class="code">Uint8Array</code>. The return value is a string.</p>
</div>
<div class="refsection">
<a name="cockpit-base64-decode"></a><h3>cockpit.base64_decode()</h3>
<pre class="programlisting">
  data = cockpit.base64_decode(string, [constructor])
</pre>
<p>Decode binary data from a Base64 encoded string. The <code class="code">string</code>
        argument should be a javascript string. The returned <code class="code">data</code>&gt; will be an
        array of bytes.</p>
<p>You can pass <code class="code">Uint8Array</code>, <code class="code">Array</code> or <code class="code">String</code>
        as an alternate <code class="code">contstructor</code> if you want the decoded data in an
        alternate form. The default is to return an <code class="code">Array</code>. Note that if you use a
        <code class="code">String</code> for the decoded data, then you must guarantee that the data
        does not contain bytes that would be invalid for a string.</p>
</div>
<div class="refsection">
<a name="cockpit-utf8-encoder"></a><h3>cockpit.utf8_encoder()</h3>
<pre class="programlisting">
  encoder = cockpit.utf8_encoder([constructor])
</pre>
<p>Create an encoder for encoding a string into a UTF8 sequence of bytes.</p>
<p>You can pass <code class="code">Uint8Array</code>, <code class="code">Array</code> or <code class="code">String</code>
        as an alternate <code class="code">contstructor</code> if you want the decoded data in an
        alternate form. The default is to return an <code class="code">Array</code>.</p>
</div>
<div class="refsection">
<a name="cockpit-utf8-encoder-encode"></a><h3>encoder.encode()</h3>
<pre class="programlisting">
  data = encoder.encode(string)
</pre>
<p>Encode a <code class="code">string</code> into a UTF8 sequence of bytes.</p>
<p>The resulting <code class="code">data</code> is an array of bytes, but it's type may be
        modified by passing an alternate <code class="code">constructor</code> to
        <a class="link" href="api-cockpit.html#cockpit-utf8-encoder" title="cockpit.utf8_encoder()">cockpit.utf8_encoder()</a>.</p>
</div>
<div class="refsection">
<a name="cockpit-utf8-decoder"></a><h3>cockpit.utf8_decoder()</h3>
<pre class="programlisting">
  decoder = cockpit.utf8_decoder([fatal])
</pre>
<p>Creates a decodker to decode a UTF8 sequence of bytes data into a string.</p>
<p>If the <code class="code">fatal</code> is set to <code class="code">true</code> then the <code class="code">decoder</code>
        will throw an exception when it encounters invalid UTF8 data. By default invalid data
        will be substituted with special UTF8 characters.</p>
</div>
</div>
<div class="refsection">
<a name="cockpit-utf8-decoder-decode"></a><h2>decoder.decode()</h2>
<pre class="programlisting">
  string = decoder.decode(data, [options])
</pre>
<p>Decode an array of UTF8 bytes into a <code class="code">string</code>. The <code class="code">data</code>
        argument may be an <code class="code">Array</code>, a <code class="code">Uint8Array</code> or a string containing
        binary data.</p>
<p>If <code class="code">options</code> is passed it should be a plain javascript object. If
        <code class="code">options</code> has a <code class="code">stream</code> property equal to <code class="code">true</code>,
        then multiple invocations of this function can be made with parts of the UTF8 sequence
        of bytes. Any trailing bytes that don't yet build a complete unicode character, will be
        cached until the next invocation. To drain the last data, call this function without
        the <code class="code">stream</code> property set.</p>
</div>
<div class="refsection">
<a name="idm139751637251568"></a><h2>Cockpit Version Info</h2>
<div class="refsection">
<a name="cockpit-info"></a><h3>cockpit.info</h3>
<pre class="programlisting">
  cockpit.info["version"]
  cockpit.info["build"]
</pre>
<p>This object contains information about cockpit itself. Note that when cockpit is
        running on multiple servers, this only reflects the server that was connected to.
        The following fields are defined:</p>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term"><code class="code">"build"</code></span></p></td>
<td><p>A string containing build details.</p></td>
</tr>
<tr>
<td><p><span class="term"><code class="code">"version"</code></span></p></td>
<td><p>A string containing the cockpit version number. It is almost always
            incorrect to use this to make a decision in code.</p></td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div class="footer"><hr></div>
</body>
</html>
